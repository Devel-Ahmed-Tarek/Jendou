# دليل نظام إدارة شركات الشحن للتاجر

## نظرة عامة

تم إضافة نظام إدارة شركات الشحن للتاجر الذي يسمح لكل تاجر بتفعيل شركة شحن واحدة فقط وإدارة تكاليف الشحن الخاصة به.

## الميزات الرئيسية

### ✅ تفعيل شركة شحن واحدة فقط

- يمكن لكل تاجر تفعيل شركة شحن واحدة فقط
- عند تفعيل شركة جديدة، يتم إلغاء تفعيل الشركة السابقة تلقائياً

### ✅ إدارة تكاليف الشحن

- **التكلفة الأساسية**: تكلفة ثابتة للشحن
- **التكلفة حسب الوزن**: تكلفة إضافية لكل كيلوجرام
- **التكلفة حسب المسافة**: تكلفة إضافية لكل كيلومتر
- **الحد الأدنى والأقصى**: تحديد حدود للتكلفة

### ✅ إدارة المناطق

- **مناطق الشحن**: تحديد المناطق التي يتم الشحن إليها
- **المناطق المستثناة**: تحديد المناطق التي لا يتم الشحن إليها

### ✅ إدارة API

- تخزين بيانات API مشفرة
- اختبار الاتصال بـ API
- دعم لجميع شركات الشحن المتاحة

### ✅ واجهة مستخدم سهلة

- عرض بصري لجميع شركات الشحن
- إحصائيات سريعة
- تعديل سريع للإعدادات

## الملفات المضافة

### 1. قاعدة البيانات

- **Migration**: `database/migrations/2024_01_02_000000_create_seller_shipping_carriers_table.php`
- **جدول**: `tl_com_seller_shipping_carriers`

### 2. النماذج

- **Model**: `plugins/tlecommercecore/src/Models/SellerShippingCarrier.php`

### 3. Repository

- **Repository**: `plugins/tlecommercecore/src/Repositories/SellerShippingCarrierRepository.php`

### 4. Controller

- **Controller**: `plugins/multivendor/src/Http/Controllers/Seller/ShippingCarrierController.php`

### 5. Views

- **View**: `plugins/multivendor/views/seller/shipping/carriers.blade.php`

### 6. Routes

- **Routes**: تم إضافتها في `plugins/multivendor/routes/web.php`

## كيفية الاستخدام

### 1. الوصول إلى الصفحة

```
التاجر → لوحة التحكم → Shipping Carriers
```

### 2. تفعيل شركة شحن

1. اختر شركة الشحن المطلوبة
2. اضغط على "Setup Carrier"
3. أدخل التكلفة الأساسية والحد الأدنى
4. أدخل التكاليف الإضافية (اختياري)
5. حدد المناطق (اختياري)
6. أدخل بيانات API (اختياري)
7. اضغط "Save Settings"

### 3. تعديل الإعدادات

1. اضغط على "Edit Settings" للشركة النشطة
2. عدل القيم المطلوبة
3. اضغط "Save Settings"

### 4. إلغاء التفعيل

1. اضغط على "Deactivate" للشركة النشطة
2. تأكيد الإجراء

### 5. حذف الشركة

1. اضغط على "Delete" للشركة
2. تأكيد الإجراء

## حساب تكلفة الشحن

### الصيغة الأساسية

```
التكلفة = التكلفة الأساسية + (الوزن × التكلفة لكل كجم) + (المسافة × التكلفة لكل كم)
```

### القيود

- إذا كانت التكلفة أقل من الحد الأدنى → استخدم الحد الأدنى
- إذا كانت التكلفة أكثر من الحد الأقصى → استخدم الحد الأقصى

### مثال

```
التكلفة الأساسية: 10
التكلفة لكل كجم: 2
التكلفة لكل كم: 0.5
الحد الأدنى: 15
الحد الأقصى: 100

لشحنة وزنها 5 كجم ومسافة 20 كم:
التكلفة = 10 + (5 × 2) + (20 × 0.5) = 10 + 10 + 10 = 30

النتيجة النهائية: 30 (ضمن الحدود)
```

## API Integration

### تخزين بيانات API

- يتم تشفير بيانات API قبل التخزين
- دعم لجميع أنواع بيانات API (JSON, XML, etc.)

### اختبار الاتصال

- يمكن اختبار الاتصال بـ API قبل الحفظ
- عرض رسائل النجاح أو الفشل

### مثال لبيانات API

```json
{
  "api_key": "your_api_key",
  "username": "your_username",
  "password": "your_password",
  "endpoint": "https://api.carrier.com"
}
```

## الأمان

### تشفير البيانات

- تشفير بيانات API باستخدام Laravel Crypt
- حماية كاملة للبيانات الحساسة

### التحقق من الصلاحيات

- التحقق من ملكية التاجر للبيانات
- منع الوصول غير المصرح به

### التحقق من المدخلات

- التحقق من صحة جميع المدخلات
- منع حقن SQL والهجمات الأخرى

## الإحصائيات

### إحصائيات سريعة

- **إجمالي الشركات**: عدد جميع شركات الشحن
- **الشركات النشطة**: عدد الشركات المفعلة
- **الشركات غير النشطة**: عدد الشركات غير المفعلة

### عرض بصري

- بطاقات ملونة لكل شركة
- مؤشرات بصرية للحالة
- أيقونات واضحة للإجراءات

## التخصيص

### إضافة شركات جديدة

1. أضف الشركة في لوحة تحكم المدير
2. ستظهر تلقائياً للتجار
3. يمكن للتجار تفعيلها فوراً

### تخصيص المناطق

- يمكن إضافة مناطق جديدة
- دعم للمناطق المحلية والوطنية والدولية

### تخصيص التكاليف

- مرونة كاملة في تحديد التكاليف
- دعم لجميع أنواع التسعير

## استكشاف الأخطاء

### مشاكل شائعة

#### 1. لا تظهر شركات الشحن

- تأكد من وجود شركات شحن في النظام
- تأكد من أن الشركات مفعلة من المدير

#### 2. لا يمكن تفعيل الشركة

- تأكد من إدخال التكلفة الأساسية والحد الأدنى
- تأكد من صحة البيانات المدخلة

#### 3. خطأ في حساب التكلفة

- تأكد من صحة الصيغ المستخدمة
- تحقق من القيم المدخلة

#### 4. مشاكل في API

- تأكد من صحة بيانات API
- اختبر الاتصال قبل الحفظ

### رسائل الخطأ

- **"Carrier not found"**: الشركة غير موجودة
- **"Failed to activate carrier"**: فشل في تفعيل الشركة
- **"API connection failed"**: فشل في الاتصال بـ API

## التطوير المستقبلي

### ميزات مقترحة

1. **دعم متعدد الشركات**: السماح بتفعيل أكثر من شركة
2. **تسعير متقدم**: دعم نطاقات الوزن والمسافة
3. **تكامل مع الخرائط**: حساب المسافات تلقائياً
4. **تقارير مفصلة**: إحصائيات الشحن
5. **إشعارات**: إشعارات عند تغيير الأسعار

### تحسينات تقنية

1. **Cache**: تخزين مؤقت للبيانات
2. **Queue**: معالجة الخلفية للعمليات الثقيلة
3. **API Rate Limiting**: حماية من الاستخدام المفرط
4. **Logging**: تسجيل جميع العمليات

## الدعم

### للمطورين

- كود مفتوح المصدر
- توثيق شامل
- قابل للتخصيص

### للمستخدمين

- واجهة سهلة الاستخدام
- دليل مفصل
- دعم فني متاح

## الخلاصة

نظام إدارة شركات الشحن للتاجر يوفر حلاً شاملاً ومتطوراً لإدارة الشحن، مع التركيز على البساطة والأمان والمرونة. النظام مصمم ليكون سهل الاستخدام وقابل للتطوير والتخصيص حسب احتياجات كل مشروع.
